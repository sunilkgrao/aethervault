{% load sc_extras %}
<div class="card">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-start gap-2">
      <div class="sc-meta">
        <a href="/accounts/u/{{ comment.author.username }}/">{{ comment.author.username }}</a>
        • {{ comment.created_at|date:"Y-m-d H:i" }}
      </div>
      {% if user.is_authenticated %}
        <div class="d-flex gap-1">
          <form method="post" action="/posts/comments/{{ comment.id }}/vote/">
            {% csrf_token %}
            <input type="hidden" name="value" value="1" />
            <button class="btn btn-sm btn-primary" type="submit">▲</button>
          </form>
          <form method="post" action="/posts/comments/{{ comment.id }}/vote/">
            {% csrf_token %}
            <input type="hidden" name="value" value="-1" />
            <button class="btn btn-sm btn-outline-dark" type="submit">▼</button>
          </form>
        </div>
      {% endif %}
    </div>

    <div class="sc-prose mt-2">{{ comment.body_html|safe }}</div>

    {% if comment.attachments.all %}
      <div class="sc-meta mt-3">Attachments</div>
      <ul class="mb-0">
        {% for a in comment.attachments.all %}
          <li>
            <a href="/attachments/{{ a.id }}/download/">{{ a.original_name }}</a>
            <span class="sc-meta">({{ a.size_bytes }} bytes)</span>
          </li>
        {% endfor %}
      </ul>
    {% endif %}

    {% if user.is_authenticated and not post.is_locked %}
      <div class="mt-3">
        <a class="btn btn-sm btn-outline-dark" href="{{ post.get_absolute_url }}?reply_to={{ comment.id }}#comment-form">Reply</a>
      </div>
    {% endif %}
  </div>

  {% with children=comments_by_parent|get_item:comment.id %}
    {% if children %}
      <div class="card-footer bg-transparent border-0 pt-0">
        <div class="d-flex flex-column gap-2 ms-3">
          {% for child in children %}
            {% include "posts/_comment.html" with comment=child comments_by_parent=comments_by_parent post=post %}
          {% endfor %}
        </div>
      </div>
    {% endif %}
  {% endwith %}
</div>
